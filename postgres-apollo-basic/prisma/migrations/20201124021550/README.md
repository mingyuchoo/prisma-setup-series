# Migration `20201124021550`

This migration has been generated by mingyuchoo at 11/24/2020, 11:15:50 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "User" (
"id" SERIAL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "email" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "role" "Role" NOT NULL DEFAULT E'USER',

    PRIMARY KEY ("id")
)

CREATE TABLE "Profile" (
"id" SERIAL,
    "bio" TEXT NOT NULL,
    "userId" INTEGER NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Post" (
"id" SERIAL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "title" TEXT NOT NULL,
    "published" BOOLEAN NOT NULL DEFAULT false,
    "authorId" INTEGER NOT NULL,
    "keywords" TEXT[],

    PRIMARY KEY ("id")
)

CREATE TABLE "Category" (
"id" SERIAL,
    "name" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Comment" (
"id" SERIAL,
    "title" TEXT NOT NULL,
    "content" TEXT,
    "postId" INTEGER,

    PRIMARY KEY ("id")
)

CREATE TABLE "Tag" (
    "name" TEXT NOT NULL,

    PRIMARY KEY ("name")
)

CREATE TABLE "_CategoryToPost" (
    "A" INTEGER NOT NULL,
    "B" INTEGER NOT NULL
)

CREATE UNIQUE INDEX "User.email_unique" ON "User"("email")

CREATE UNIQUE INDEX "Profile_userId_unique" ON "Profile"("userId")

CREATE UNIQUE INDEX "_CategoryToPost_AB_unique" ON "_CategoryToPost"("A", "B")

CREATE INDEX "_CategoryToPost_B_index" ON "_CategoryToPost"("B")

ALTER TABLE "Profile" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Post" ADD FOREIGN KEY("authorId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Comment" ADD FOREIGN KEY("postId")REFERENCES "Post"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "_CategoryToPost" ADD FOREIGN KEY("A")REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_CategoryToPost" ADD FOREIGN KEY("B")REFERENCES "Post"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201124021550
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,68 @@
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+
+
+// Prisma를 PostgreSQL와 함께 사용할 경우에는
+// User, Profile, createAt ..  같은 대소문자가 혼합된 객체를
+// PostgreSQL이 구분하므로 SQL 문장에 double quaote(")를 사용해서
+// 구분해주어야 한다.
+
+
+enum Role {
+  USER
+  ADMIN
+}
+
+model User {
+  id        Int      @default(autoincrement()) @id
+  createdAt DateTime @default(now())
+  email     String   @unique
+  name      String
+  role      Role     @default(USER)
+  posts     Post[]  // A user can have many posts
+  profile   Profile?
+}
+
+model Profile {
+  id     Int    @default(autoincrement()) @id
+  bio    String
+  userId Int
+  user   User   @relation(fields: [userId], references: [id]) // A Profile can have one user
+}
+
+model Post {
+  id         Int        @default(autoincrement()) @id
+  createdAt  DateTime   @default(now())
+  title      String
+  published  Boolean    @default(false)
+  authorId   Int
+  author     User       @relation(fields: [authorId], references: [id]) // A Post can have one author
+  categories Category[] @relation(references: [id]) // A Post can have many categories
+  comments   Comment[] // A post can have many comments
+  keywords   String[] // A scalar list
+}
+
+model Category {
+  id    Int    @default(autoincrement()) @id
+  name  String
+  posts Post[] @relation(references: [id]) // A comment can have many posts
+}
+
+model Comment {
+  id      Int     @id @default(autoincrement())
+  title   String
+  content String?
+  postId  Int?
+  Post    Post?   @relation(fields: [postId], references: [id])  // A comment can have one post
+}
+
+model Tag {
+  name  String  @id
+}
```


